<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kamailio WebSocket - Návod na zprovoznění</title>
<style>
    body {
        font-family: Arial, sans-serif;
        line-height: 1.6;
        max-width: 900px;
        margin: 0 auto;
        padding: 20px;
        background: #121212;       /* tmavé pozadí stránky */
        color: #e0e0e0;            /* světlý text */
    }

    .container {
        background: #1e1e1e;       /* tmavý box */
        padding: 40px;
        border-radius: 8px;
        box-shadow: 0 0 20px rgba(0,0,0,0.7);
    }

    h1 {
        color: #4dabf7;
        border-bottom: 3px solid #4dabf7;
        padding-bottom: 10px;
    }

    h2 {
        color: #4dabf7;
        margin-top: 40px;
        padding-top: 20px;
        border-top: 1px solid #333;
    }

    h3, h4 {
        color: #b3d4fc;
    }

    p, li {
        color: #d0d0d0;
    }

    .code {
        background: #0d0d0d;
        border-left: 4px solid #4dabf7;
        padding: 15px;
        margin: 15px 0;
        font-family: 'Courier New', monospace;
        color: #fff;            /* terminálově zelený text */
        overflow-x: auto;
        white-space: pre;
    }

    .screenshot {
        max-width: 100%;
        border: 1px solid #333;
        border-radius: 6px;
        box-shadow: 0 0 15px rgba(0,0,0,0.8);
        margin: 20px 0;
        background: #000;          /* sladění s tmavými screenshoty */
    }

    .success {
        background: #0f2f1f;
        border-left: 4px solid #00c853;
        padding: 15px;
        margin: 15px 0;
    }

    .info {
        background: #0d2a33;
        border-left: 4px solid #4dabf7;
        padding: 15px;
        margin: 15px 0;
    }

    .warning {
        background: #332b00;
        border-left: 4px solid #ffb300;
        padding: 15px;
        margin: 15px 0;
    }

    .explanation {
        background: #222;
        border-left: 4px solid #666;
        padding: 15px;
        margin: 15px 0;
    }

    ul, ol {
        margin-left: 30px;
    }

    li {
        margin: 8px 0;
    }
</style>
</head>
<body>
    <div class="container">
        <h1>Kamailio WebSocket</h1>
        
        <h2>Instalace Kamailio a potřebných modulů</h2>
        
        <ul>
            <li><strong>kamailio</strong>
            <li><strong>kamailio-websocket-modules</strong>
            <li><strong>kamailio-tls-modules</strong>
            <li><strong>kamailio-extra-modules</strong>
        </ul>
        <div class="code">sudo apt-get update
sudo apt-get install kamailio kamailio-websocket-modules kamailio-tls-modules kamailio-extra-modules</div>

        <h2> Zjištění IP adresy serveru</h2>

        <div class="code">ip addr show</div>

        <h2> Vytvoření SSL certifikátů</h2>
        
        <div class="code">sudo mkdir -p /etc/kamailio/ssl
cd /etc/kamailio/ssl</div>

        <h3>Generování private key:</h3>
        <div class="code">sudo openssl genrsa -out kamailio-key.pem 2048</div>

        <h3>Generování certifikátu:</h3>
        <div class="code">sudo openssl req -new -x509 -key kamailio-key.pem -out kamailio-cert.pem -days 365 -subj "/CN=172.28.215.122"</div>

        <h3>Nastavení oprávnění k souborům:</h3>
        <div class="code">sudo chmod 600 kamailio-key.pem
sudo chmod 644 kamailio-cert.pem</div>

        <h2>Vytvoření TLS konfigurační souboru</h2>

        <h3>Vytvoření souboru:</h3>
        <div class="code">sudo nano /etc/kamailio/tls.cfg</div>

        <h3>Obsah souboru tls.cfg:</h3>
        <img src="kamailio.png" alt="Kamailio log" class="screenshot">

        <h2>Konfigurace hlavního souboru kamailio.cfg</h2>

        <h3>Otevření souboru:</h3>
        <div class="code">sudo nano /etc/kamailio/kamailio.cfg</div>

        <h3>Struktura konfiguračního souboru:</h3>
        
        <h4>1. Globální parametry (začátek souboru):</h4>
        <img src="kamailio2.png" alt="Kamailio log" class="screenshot">

        <h4>2. Nastavení portů (listen direktivy):</h4>
        <img src="kamailio3.png" alt="Kamailio log" class="screenshot">


        <h4>3. Načítání modulů (loadmodule):</h4>
        <p>Moduly přidávají funkčnost do Kamailio. Každý modul se musí načíst před použitím:</p>

 <img src="kamailio4.png" alt="Kamailio log" class="screenshot">

        <h4>4. Parametry modulů (modparam):</h4>
        <p>Každý modul lze konfigurovat pomocí parametrů:</p>

<img src="kamailio5.png" alt="Kamailio log" class="screenshot">


        <h4>5. Routing logika (request_route):</h4>
        <p>Toto je "srdce" Kamailio - zde se rozhoduje, jak se zpracují příchozí SIP zprávy:</p>

        <div class="code">request_route {
    route(REQINIT);      # Úvodní kontroly
    route(WITHINDLG);    # Zpracování dialogů
    route(REGISTRAR);    # Registrace uživatelů
    route(LOCATION);     # Vyhledání uživatele
}</div>

        <h4>6. Event routes pro WebSocket:</h4>
        <div class="code">event_route[xhttp:request] {
    # Zpracování HTTP/WebSocket požadavků
    if ($hdr(Upgrade) =~ "websocket") {
        ws_handle_handshake();
    }
}</div>

        <h2>Kontrola konfigurace</h2>

        <h3>Příkaz pro kontrolu:</h3>
        <div class="code">sudo kamailio -c -f /etc/kamailio/kamailio.cfg</div>

        <div class="success">
            <strong>Očekávaný výstup při úspěchu:</strong>
            <div class="code">Listening on
             udp: 172.28.215.122:5060
             tcp: 172.28.215.122:5060
             tcp: 172.28.215.122:8080
Aliases:
             *: 172.28.215.122:*
config file ok, exiting...</div>
            <p>Poslední řádek "config file ok, exiting..." znamená, že konfigurace je v pořádku.</p>
        </div>

        <img src="kamailio6.png" alt="Kamailio log" class="screenshot">

        <h2>Spuštění Kamailio</h2>

        <h3>Restart služby:</h3>
        <div class="code">sudo systemctl restart kamailio</div>

        <h3>Kontrola stavu:</h3>
        <div class="code">sudo systemctl status kamailio</div>

        <div class="success">
            <strong>Pokud vše bude fungovat:</strong>
            <div class="code">Active: active (running)</div>
        </div>

        <img src="kamailio7.png" alt="Kamailio log" class="screenshot">

        <h3>Kontrola portů:</h3>
        <div class="code">sudo netstat -tulpn | grep kamailio</div>

        <div class="info">
            <strong>Mělo by se zobrazit:</strong>
            <div class="code">tcp   0  0  172.28.215.122:5060   0.0.0.0:*   LISTEN  PID/kamailio
udp   0  0  172.28.215.122:5060   0.0.0.0:*           PID/kamailio
tcp   0  0  172.28.215.122:5061   0.0.0.0:*   LISTEN  PID/kamailio
tcp   0  0  172.28.215.122:8080   0.0.0.0:*   LISTEN  PID/kamailio
tcp   0  0  172.28.215.122:8443   0.0.0.0:*   LISTEN  PID/kamailio</div>
        </div>

        <img src="kamailio8.png" alt="Kamailio log" class="screenshot">

        <h2> Sledování logů</h2>

        <h3>Příkaz pro sledování logů v reálném čase:</h3>
        <div class="code">sudo journalctl -u kamailio -f</div>

        <h3>Zobrazení posledních 50 záznamů:</h3>
        <div class="code">sudo journalctl -u kamailio -n 50</div>

        <h3>Vyhledávání chyb v logu:</h3>
        <div class="code">sudo journalctl -u kamailio | grep -i error</div>

                <h2>Reference a další zdroje</h2>
        
        <h3>Oficiální dokumentace Kamailio:</h3>
        <ul>
            <li><strong>WebSocket modul dokumentace:</strong><br>
                <a href="https://www.kamailio.org/docs/modules/6.0.x/modules/websocket.html" target="_blank">https://www.kamailio.org/docs/modules/6.0.x/modules/websocket.html</a><br>
                Kompletní dokumentace WebSocket modulu včetně všech parametrů a funkcí.
            </li>
            
            <li><strong>Kamailio WebSocket setup guide:</strong><br>
                <a href="https://www.kamailio.org/w/2012/07/websockets/" target="_blank">https://www.kamailio.org/w/2012/07/websockets/</a><br>
                Oficiální průvodce nastavením WebSocket v Kamailio.
            </li>
            
            <li><strong>TLS modul dokumentace:</strong><br>
                <a href="https://www.kamailio.org/docs/modules/6.0.x/modules/tls.html" target="_blank">https://www.kamailio.org/docs/modules/6.0.x/modules/tls.html</a><br>
                Dokumentace TLS modulu pro zabezpečenou komunikaci.
            </li>
        </ul>

        <h3>Příklady a návody:</h3>
        <ul>
            <li><strong>Configuring Kamailio 4.x WebSocket:</strong><br>
                <a href="https://nil.uniza.sk/en/configuring-kamailio-4x-websocket/" target="_blank">https://nil.uniza.sk/en/configuring-kamailio-4x-websocket/</a><br>
                Praktický průvodce konfigurací WebSocket s příklady.
            </li>
            
            <li><strong>Kamailio mailing list - WebSocket diskuze:</strong><br>
                <a href="https://kamailio.org/mailman3/hyperkitty/list/sr-users@lists.kamailio.org/thread/NUVA6ZAEESM76X5WOCUMWG4UKP775A2Z/" target="_blank">https://kamailio.org/mailman3/hyperkitty/list/sr-users@lists.kamailio.org/</a><br>
                Diskuzní vlákno s řešením běžných problémů s WebSocket.
            </li>
        </ul>